# First deploy — краткое руководство

Дата: 2025-12-13

Контекст
- Этот файл — краткое, практическое руководство для быстрого первого деплоя графической среды: какие команды выполнить и какие проверки провести. Технические детали и обоснования оформляются отдельно в соседнем документе.

Ключевые изменения
- Разделение этапов и инструментов: `chezmoi` используется в два шага (инициализация + выборочный apply), добавлены инструменты для привилегированной записи и небольшие стратегии проверки системных файлов.
- Цель изменений — обеспечить идемпотентный деплой, корректные права и владельцев на целевой машине, и минимальную ручную настройку после клона репозитория.

Инструкции для первого деплоя
1) Как пользователь (целевой):
   - `sudo -u <user> chezmoi init --source <repo>`
   - `sudo -u <user> chezmoi apply --exclude etc/**`
2) Как root:
   - `sudo chezmoi init --source <repo>`
   - `sudo chezmoi apply --include etc/**`

Проверки
- Проверьте на целевой машине:
  - `/etc/lightdm/lightdm.conf.d/add-and-set-resolution.sh` — владелец `lightdm:lightdm`, режим `0755`.
  - `/etc/lightdm/lightdm.conf.d/10-config.conf` — владелец `root:root`, режим `0644`.
  - `~/.xinitrc` целевого пользователя существует и имеет ожидаемое содержимое/права.

Дальше
- После валидации в VM — закоммитьте изменения и убедитесь, что исполняемые файлы имеют флаг `+x` в git-индексе.
