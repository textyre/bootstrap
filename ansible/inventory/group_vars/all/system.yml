---
# === СИСТЕМНАЯ КОНФИГУРАЦИЯ ===
# Переменные для ролей: base_system, user, ssh, git, shell, docker, firewall, chezmoi
#
# Ansible precedence: role defaults (2) < group_vars/all (4) < host_vars (8) < -e (22)

# ============================================================
#  Общие переменные (используются всеми ролями)
# ============================================================

# Единый целевой пользователь — все роли ссылаются на эту переменную
target_user: "{{ ansible_facts['env']['SUDO_USER'] | default(ansible_facts['user_id']) }}"

# Базовая директория дотфайлов (dotfiles/ в корне репозитория)
# REPO_ROOT задаётся в Taskfile.yml → абсолютный путь к корню репозитория
dotfiles_base_dir: "{{ lookup('env', 'REPO_ROOT') }}/dotfiles"

# ============================================================
#  base_system — роль roles/base_system
# ============================================================

base_system_locale: "en_US.UTF-8"
base_system_timezone: "Asia/Almaty"
base_system_hostname: "archbox"
base_system_pacman_parallel_downloads: 5
base_system_pacman_color: true
base_system_pacman_verbose_pkg_lists: true

# Внешний кэш pacman (опционально)
base_system_setup_pacman_cache: false
base_system_pacman_cache_root: ""

# ============================================================
#  user — роль roles/user
# ============================================================

user_name: "{{ target_user }}"
user_shell: /bin/bash
user_groups:
  - wheel
user_create_sudo_rule: true

# ============================================================
#  ssh — роль roles/ssh
# ============================================================

ssh_user: "{{ target_user }}"
ssh_generate_key: true
ssh_key_type: ed25519
ssh_harden_sshd: true
ssh_permit_root_login: "no"
ssh_password_authentication: "no"

# ============================================================
#  git — роль roles/git
# ============================================================

git_target_user: "{{ target_user }}"
git_user_name: ""
git_user_email: ""
git_default_branch: "main"
git_editor: "vim"

# ============================================================
#  shell — роль roles/shell
# ============================================================

shell_user: "{{ target_user }}"
shell_type: bash
# chezmoi управляет .bashrc и .zshrc — shell role не деплоит конфиг
shell_deploy_config: false

# ============================================================
#  docker — роль roles/docker
# ============================================================

docker_user: "{{ target_user }}"
docker_enable_service: true
docker_add_user_to_group: true

# ============================================================
#  firewall — роль roles/firewall
# ============================================================

firewall_enabled: true
firewall_allow_ssh: true

# ============================================================
#  chezmoi — роль roles/chezmoi
# ============================================================

chezmoi_user: "{{ target_user }}"
chezmoi_install_method: pacman

# ============================================================
#  gpu_drivers — роль roles/gpu_drivers
# ============================================================

gpu_drivers_nvidia_proprietary: true
gpu_drivers_multilib: false

# ============================================================
#  sysctl — роль roles/sysctl
# ============================================================

# Используются дефолты роли; переопределить при необходимости:
# sysctl_vm_swappiness: 10
# sysctl_fs_inotify_max_user_watches: 524288

# ============================================================
#  power_management — роль roles/power_management
# ============================================================

# auto = detect via DMI chassis_type; override with 'laptop' or 'desktop'
power_management_device_type: auto
