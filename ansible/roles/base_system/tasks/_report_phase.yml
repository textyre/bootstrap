---
# =========================================================================
# _report_phase.yml
# =========================================================================
# Append a formatted row to the base_system role execution report table.
#
# Usage:
#   - ansible.builtin.include_tasks: _report_phase.yml
#     vars:
#       _rpt_phase: "Configure locale"
#       _rpt_detail: "en_US.UTF-8, ru_RU.UTF-8"
#
#   - ansible.builtin.include_tasks: _report_phase.yml
#     vars:
#       _rpt_phase: "Console keymap"
#       _rpt_status: "skip"
#       _rpt_detail: "unknown init system"
#
# Parameters:
#   _rpt_phase  (string) - Phase name (max 26 chars)
#   _rpt_status (string) - done / skip / fail (default: done)
#   _rpt_detail (string) - Payload info (default: '')
#
# Table format: | Phase(26) | Status(10) | Details(24) |
# Total width: 70 chars (fits 80-col terminal)
# =========================================================================

- name: "Report: {{ _rpt_phase }}"
  ansible.builtin.set_fact:
    _base_system_phases: "{{ (_base_system_phases | default([])) + [_row] }}"
  vars:
    _st: "{{ _rpt_status | default('done') }}"
    _mk: "{{ '+' if _st == 'done' else ('-' if _st == 'skip' else '!') }}"
    _row: "| {{ '%-26s' | format(_rpt_phase) }} | {{ '%-10s' | format(_mk ~ ' ' ~ _st) }} | {{ '%-24s' | format(_rpt_detail | default('') | truncate(24, True)) }} |"
  tags: ['system', 'report']
