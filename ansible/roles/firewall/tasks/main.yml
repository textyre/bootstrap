---
# === Базовый firewall (nftables) ===
# Минимальный набор правил для рабочей станции

- name: Install nftables (OS-specific)
  ansible.builtin.include_tasks: "install-{{ ansible_facts['os_family'] | lower }}.yml"
  tags: ['firewall', 'install']

- name: Deploy nftables configuration
  ansible.builtin.template:
    src: nftables.conf.j2
    dest: /etc/nftables.conf
    owner: root
    group: root
    mode: '0644'
  notify: Restart nftables
  when: firewall_enabled
  tags: ['firewall', 'configure']

- name: Enable nftables service
  ansible.builtin.service:
    name: nftables
    enabled: true
  when: firewall_enabled and firewall_enable_service
  tags: ['firewall', 'service']

- name: Start nftables service
  ansible.builtin.service:
    name: nftables
    state: started
  when: firewall_enabled and firewall_start_service
  tags: ['firewall', 'service']
