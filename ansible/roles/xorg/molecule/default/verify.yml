---
- name: Verify
  hosts: all
  become: true
  gather_facts: true
  vars_files:
    - "{{ lookup('env', 'MOLECULE_PROJECT_DIRECTORY') }}/inventory/group_vars/all/vault.yml"

  tasks:
    - name: Check /etc/X11/xorg.conf.d/10-monitor.conf exists
      ansible.builtin.stat:
        path: /etc/X11/xorg.conf.d/10-monitor.conf
      register: xorg_verify_xorg_monitor
      failed_when: not xorg_verify_xorg_monitor.stat.exists

    - name: Check 10-monitor.conf ownership
      ansible.builtin.stat:
        path: /etc/X11/xorg.conf.d/10-monitor.conf
      register: xorg_verify_xorg_perms
      failed_when: >
        xorg_verify_xorg_perms.stat.pw_name != 'root' or
        xorg_verify_xorg_perms.stat.gr_name != 'root' or
        xorg_verify_xorg_perms.stat.mode != '0644'

    - name: Show test results
      ansible.builtin.debug:
        msg:
          - "All checks passed!"
          - "10-monitor.conf deployed (root:root, 0644)"
