---
# Handlers for gpu_drivers role

# ---- Initramfs regeneration (init-agnostic via listen:) ----

- name: Regenerate initramfs (mkinitcpio)
  ansible.builtin.command: mkinitcpio -P
  listen: "regenerate initramfs"
  changed_when: true
  when:
    - gpu_drivers_initramfs_tool is defined
    - gpu_drivers_initramfs_tool == 'mkinitcpio'

- name: Regenerate initramfs (dracut)
  ansible.builtin.command: dracut --force
  listen: "regenerate initramfs"
  changed_when: true
  when:
    - gpu_drivers_initramfs_tool is defined
    - gpu_drivers_initramfs_tool == 'dracut'

- name: Regenerate initramfs (initramfs-tools)
  ansible.builtin.command: update-initramfs -u -k all
  listen: "regenerate initramfs"
  changed_when: true
  when:
    - gpu_drivers_initramfs_tool is defined
    - gpu_drivers_initramfs_tool == 'initramfs-tools'
