---
# === PAM faillock — диспетчер ===
# 1. Записать faillock.conf (универсально, все платформы)
# 2. Активировать faillock в PAM стеке (зависит от платформы)

- name: Configure pam_faillock defaults
  ansible.builtin.template:
    src: faillock.conf.j2
    dest: /etc/security/faillock.conf
    owner: root
    group: root
    mode: '0644'
  tags: ['pam', 'security', 'faillock']

# Debian / Ubuntu — pam-auth-update
- name: Configure PAM stack (Debian)
  ansible.builtin.include_tasks: faillock_debian.yml
  when: ansible_facts['os_family'] == 'Debian'
  tags: ['pam', 'security', 'faillock']

# Fedora — authselect
- name: Configure PAM stack (RedHat/Fedora)
  ansible.builtin.include_tasks: faillock_redhat.yml
  when: ansible_facts['os_family'] == 'RedHat'
  tags: ['pam', 'security', 'faillock']

# Arch Linux / Void Linux — прямой lineinfile
- name: Configure PAM stack (Arch/Void)
  ansible.builtin.include_tasks: faillock_arch.yml
  when: ansible_facts['os_family'] in ['Archlinux', 'Void']
  tags: ['pam', 'security', 'faillock']
