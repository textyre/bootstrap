---
driver:
  name: vagrant
  provider:
    name: libvirt

platforms:
  - name: arch-vm
    box: arch-base
    box_url: https://github.com/textyre/arch-images/releases/latest/download/arch-base.box
    memory: 2048
    cpus: 2
  - name: ubuntu-base
    box: ubuntu-base
    box_url: https://github.com/textyre/ubuntu-images/releases/latest/download/ubuntu-base.box
    memory: 2048
    cpus: 2

provisioner:
  name: ansible
  options:
    skip-tags: report,upgrade
  env:
    ANSIBLE_ROLES_PATH: "${MOLECULE_PROJECT_DIRECTORY}/../"
  config_options:
    defaults:
      callbacks_enabled: profile_tasks
  inventory:
    host_vars:
      arch-vm:
        # Full production package list (mirrors ansible/inventory/group_vars/all/packages.yml)
        packages_base: [git, curl, htop, tmux, unzip, rsync, openssh, chezmoi, nftables, cronie, sqlite]
        packages_editors: [vim, neovim]
        packages_docker: [docker, docker-compose, python-requests]
        packages_xorg: [xorg-server, xrandr, xorg-xinit, xf86-input-libinput]
        packages_wm: [picom, dmenu, rofi, dunst, feh, flameshot, gsimplecal]
        packages_filemanager: [thunar, thunar-volman, tumbler, gvfs]
        packages_network: [networkmanager, network-manager-applet]
        packages_media: [playerctl, pamixer, brightnessctl]
        packages_desktop: [xdg-utils, xdg-user-dirs, xss-lock, maim, imagemagick, lxappearance, arandr]
        packages_graphics: [mesa]
        packages_session: [lightdm]
        packages_terminal: [alacritty, starship]
        packages_fonts:
          - ttf-jetbrains-mono-nerd
          - ttf-firacode-nerd
          - ttf-hack-nerd
          - ttf-iosevka-nerd
          - ttf-nerd-fonts-symbols
          - otf-font-awesome
          - noto-fonts
          - terminus-font
        packages_theming: [papirus-icon-theme]
        packages_search: [fzf, ripgrep]
        packages_viewers: [bat, jq]
        packages_distro:
          Archlinux: [base-devel, pacman-contrib, perl]

      ubuntu-base:
        # Ubuntu-compatible equivalents (different names where needed, Arch-only packages excluded)
        packages_base: [git, curl, htop, tmux, unzip, rsync, openssh-client, openssh-server, nftables, cron, sqlite3]
        packages_editors: [vim, neovim]
        packages_docker: [docker.io, python3-requests]
        packages_xorg: [xorg, xinit]
        packages_wm: [picom, suckless-tools, rofi, dunst, feh, flameshot]
        packages_filemanager: [thunar, thunar-volman, tumbler, gvfs]
        packages_network: [network-manager, network-manager-gnome]
        packages_media: [playerctl, brightnessctl]
        packages_desktop: [xdg-utils, xdg-user-dirs, xss-lock, imagemagick, lxappearance, arandr]
        packages_session: [lightdm]
        packages_fonts: [fonts-font-awesome, fonts-noto, xfonts-terminus]
        packages_theming: [papirus-icon-theme]
        packages_search: [fzf, ripgrep]
        packages_viewers: [bat, jq]
        packages_distro:
          Debian: [build-essential]
  playbooks:
    prepare: prepare.yml
    converge: ../shared/converge.yml
    verify: ../shared/verify.yml

verifier:
  name: ansible

scenario:
  test_sequence:
    - syntax
    - create
    - prepare
    - converge
    - idempotence
    - verify
    - destroy
