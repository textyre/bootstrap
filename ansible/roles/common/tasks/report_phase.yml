---
# =========================================================================
# report_phase.yml â€” shared execution report row builder
# =========================================================================
# Append a formatted row to a role's execution report table.
# Designed to be included from any role via:
#
#   - ansible.builtin.include_role:
#       name: common
#       tasks_from: report_phase.yml
#     vars:
#       common_rpt_fact: "_base_system_phases"
#       common_rpt_phase: "Configure locale"
#       common_rpt_detail: "en_US.UTF-8"
#
# Parameters:
#   _rpt_fact   (string) - Fact name to accumulate rows into (REQUIRED)
#   _rpt_phase  (string) - Phase name (max 26 chars)
#   _rpt_status (string) - done / skip / fail (default: done)
#   _rpt_detail (string) - Payload info (default: '')
#
# Table format: | Phase(26) | Status(10) | Details(24) |
# Total width: 70 chars (fits 80-col terminal)
#
# Render the final table in your role:
#   - ansible.builtin.include_role:
#       name: common
#       tasks_from: report_render.yml
#     vars:
#       common_rpt_fact: "_base_system_phases"
#       common_rpt_title: "base_system"
# =========================================================================

- name: "Report: {{ common_rpt_phase }}"
  ansible.builtin.set_fact:
    "{{ common_rpt_fact }}": "{{ (lookup('vars', _rpt_fact, default=[]) | list) + [_row] }}"
  vars:
    _common_rpt_status_mark: "{{ rpt_status | default('done') }}"
    _common_rpt_mark: "{{ '+' if _st == 'done' else ('-' if _st == 'skip' else '!') }}"
    _row: "| {{ '%-26s' | format(_rpt_phase) }} | {{ '%-10s' | format(_mk ~ ' ' ~ _st) }} | {{ '%-24s' | format(_rpt_detail | default('') | truncate(24, True)) }} |"
