---
# === power_management â€” orchestrator ===
# Each import_tasks has Single Responsibility

- name: Detect hardware and init system
  ansible.builtin.import_tasks: detect.yml
  when: power_management_enabled | bool

- name: Pre-flight safety checks
  ansible.builtin.import_tasks: preflight.yml
  when: power_management_enabled | bool

- name: Disable conflicting power services
  ansible.builtin.import_tasks: conflicts.yml
  when: power_management_enabled | bool

- name: Install packages
  ansible.builtin.import_tasks: install.yml
  when: power_management_enabled | bool

- name: Configure TLP
  ansible.builtin.import_tasks: tlp.yml
  when: power_management_enabled | bool

- name: Configure CPU governor
  ansible.builtin.import_tasks: governor.yml
  when: power_management_enabled | bool

- name: Configure systemd sleep
  ansible.builtin.import_tasks: sleep.yml
  when:
    - power_management_enabled | bool
    - power_management_init == 'systemd'

- name: Configure logind power behaviour
  ansible.builtin.import_tasks: logind.yml
  when:
    - power_management_enabled | bool
    - power_management_init == 'systemd'

- name: Collect system power facts
  ansible.builtin.import_tasks: collect_facts.yml
  when: power_management_enabled | bool

- name: Assert deploy effectiveness
  ansible.builtin.import_tasks: assert.yml
  when: power_management_enabled | bool

- name: Detect configuration drift
  ansible.builtin.import_tasks: drift_detection.yml
  when:
    - power_management_enabled | bool
    - power_management_drift_detection | bool

- name: Deploy audit monitoring
  ansible.builtin.import_tasks: audit.yml
  when:
    - power_management_enabled | bool
    - power_management_audit_enabled | bool

- name: Report configuration summary
  ansible.builtin.import_tasks: report.yml
  when: power_management_enabled | bool
