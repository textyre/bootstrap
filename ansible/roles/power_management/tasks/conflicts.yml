---
# === power_management / conflicts ===
# Disable services that conflict with TLP and manual governor control

# ---- power-profiles-daemon ----

- name: Stop and mask power-profiles-daemon (laptop — conflicts with TLP)
  ansible.builtin.systemd:
    name: power-profiles-daemon
    state: stopped
    masked: true
  failed_when: false
  when:
    - _power_management_is_laptop
    - _power_management_init == 'systemd'
  tags: ['power', 'conflicts']

- name: Stop and mask power-profiles-daemon (desktop — conflicts with manual governor)
  ansible.builtin.systemd:
    name: power-profiles-daemon
    state: stopped
    masked: true
  failed_when: false
  when:
    - not _power_management_is_laptop
    - _power_management_init == 'systemd'
    - power_management_governor_persist != 'oneshot'
  tags: ['power', 'conflicts']

# ---- auto-cpufreq ----

- name: Stop and mask auto-cpufreq
  ansible.builtin.systemd:
    name: auto-cpufreq
    state: stopped
    masked: true
  failed_when: false
  when:
    - _power_management_init == 'systemd'
  tags: ['power', 'conflicts']
