---
# Проверка локали (Alpine / musl)

- name: Verify musl-locales package installed
  ansible.builtin.command: apk info -e musl-locales
  register: _locale_musl_check
  changed_when: false
  failed_when: _locale_musl_check.rc != 0
  tags: ['locale']

- name: Verify profile.d locale script exists
  ansible.builtin.stat:
    path: /etc/profile.d/10-locale.sh
  register: _locale_profiled_check
  tags: ['locale']

- name: Assert locale profile.d script is valid
  ansible.builtin.assert:
    that:
      - _locale_profiled_check.stat.exists
      - _locale_profiled_check.stat.mode == '0755'
    fail_msg: "/etc/profile.d/10-locale.sh missing or wrong permissions"
    quiet: true
  tags: ['locale']
