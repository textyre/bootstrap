---
- name: Converge
  hosts: all
  become: true
  gather_facts: true

  roles:
    - role: teleport
      vars:
        teleport_auth_server: "localhost:3025"
        teleport_join_token: "test-token-molecule"
        teleport_node_name: "molecule-test"
        teleport_session_recording: "proxy"
        teleport_enhanced_recording: true
        teleport_labels:
          env: molecule
          role: workstation
        teleport_export_ca_key: false

# Play 2: verify teleport_enabled=false is a no-op (config written by Play 1 stays intact)
- name: "Converge â€” verify teleport_enabled=false skips role"
  hosts: all
  become: true
  gather_facts: true
  tasks:
    - name: "Run teleport role with teleport_enabled=false"
      ansible.builtin.include_role:
        name: teleport
      vars:
        teleport_enabled: false
        teleport_auth_server: ""
        teleport_join_token: ""
