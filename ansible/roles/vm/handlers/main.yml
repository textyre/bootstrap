---
# === VM role handlers ===
# These handlers are triggered by notify directives in task files.

- name: Restart VirtualBox services
  ansible.builtin.service:
    name: "{{ vm_vbox_service_name | default('vboxservice') }}"
    state: restarted
  failed_when: false
  listen: "Restart virtualbox services"

- name: Restart VMware services
  ansible.builtin.service:
    name: "{{ item }}"
    state: restarted
  loop:
    - vmtoolsd
    - vgauthd
  failed_when: false
  listen: "Restart vmware services"

- name: Restart VMware vmblock-fuse
  ansible.builtin.service:
    name: vmware-vmblock-fuse
    state: restarted
  failed_when: false
  listen: "Restart vmware services"

- name: Restart Hyper-V services
  ansible.builtin.service:
    name: "{{ item }}"
    state: restarted
  loop:
    - hv_fcopy_daemon
    - hv_kvp_daemon
    - hv_vss_daemon
  failed_when: false
  listen: "Restart hyper-v services"

- name: Restart KVM services
  ansible.builtin.service:
    name: qemu-guest-agent
    state: restarted
  failed_when: false
  listen: "Restart kvm services"

- name: Reload systemd daemon
  ansible.builtin.systemd:
    daemon_reload: true
  when: vm_service_manager | default('systemd') == 'systemd'
  listen: "Reload systemd daemon"
