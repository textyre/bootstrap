---
# =========================================================================
# _stop_services.yml
# =========================================================================
# Stop and disable VM guest services.
#
# Required parameters:
#   vm_svc_list  (list)   - Service names to stop
#   vm_pkg_label (string) - Hypervisor name for task names
#
# Output:
#   _vm_svc_stop_result (register) - Per-service results
# =========================================================================

- name: "{{ vm_pkg_label }}: Stop and disable services"
  ansible.builtin.service:
    name: "{{ item }}"
    enabled: false
    state: stopped
  loop: "{{ vm_svc_list | default([]) }}"
  loop_control:
    label: "{{ item }}"
  register: vm_svc_stop_result
  failed_when: false
  tags: ['vm', 'vm:service']
