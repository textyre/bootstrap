---
# =========================================================================
# _remove_packages.yml
# =========================================================================
# Remove VM guest packages (per-package for granular reporting).
#
# Required parameters:
#   vm_pkg_list  (list)   - Package names to remove
#   vm_pkg_label (string) - Hypervisor name for task names
#
# Output:
#   _vm_pkg_remove_result (register) - Per-package results
# =========================================================================

- name: "{{ vm_pkg_label }}: Remove guest packages"
  ansible.builtin.package:
    name: "{{ item }}"
    state: absent
  loop: "{{ vm_pkg_list | default([]) }}"
  loop_control:
    label: "{{ item }}"
  register: vm_pkg_remove_result
  failed_when: false
  tags: ['vm', 'vm:install']
