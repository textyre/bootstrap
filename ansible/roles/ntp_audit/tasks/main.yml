---
# === ntp_audit â€” entry point ===
# Each import_tasks is one business requirement.
# To run a single module: ansible-playbook ... --tags ntp_audit_script

- name: Ntp_audit role
  when: ntp_audit_enabled | bool
  tags: ['ntp_audit']
  block:

    - name: Deploy audit script (Python zipapp)
      ansible.builtin.import_tasks: script.yml

    - name: Configure log rotation
      ansible.builtin.import_tasks: logrotate.yml

    - name: Configure systemd timer scheduler
      ansible.builtin.import_tasks: scheduler_systemd.yml

    - name: Configure cron scheduler (non-systemd fallback)
      ansible.builtin.import_tasks: scheduler_cron.yml

    - name: Assert scheduler is active
      ansible.builtin.import_tasks: scheduler_assert.yml

    - name: Deploy Grafana Alloy config fragment
      ansible.builtin.import_tasks: alloy.yml

    - name: Deploy Loki ruler alert rules
      ansible.builtin.import_tasks: loki.yml

    - name: Execute first run
      ansible.builtin.import_tasks: first_run.yml

    - name: Verify deployment
      ansible.builtin.import_tasks: verify.yml
