---
# Docker bind-mounts /etc/hostname and /etc/hosts from Docker-managed host paths.
# Atomic rename (used by systemd-hostnamed via hostnamectl and by Ansible's lineinfile)
# fails across mount point boundaries with EXDEV. Unmounting restores them as regular
# overlay files, so hostnamectl and lineinfile work without workarounds.
- name: Prepare
  hosts: all
  become: true
  gather_facts: false

  tasks:
    - name: Unmount Docker bind mounts for hostname files
      ansible.builtin.command: umount {{ item }}
      loop:
        - /etc/hostname
        - /etc/hosts
      changed_when: true
      failed_when: false
