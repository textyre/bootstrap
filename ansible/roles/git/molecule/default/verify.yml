---
- name: Verify
  hosts: all
  become: true
  gather_facts: true
  vars_files:
    - "{{ lookup('env', 'MOLECULE_PROJECT_DIRECTORY') }}/inventory/group_vars/all/vault.yml"

  tasks:
    - name: Check git init.defaultBranch  # noqa: command-instead-of-module
      become: true
      become_user: "{{ ansible_facts['env']['SUDO_USER'] | default(ansible_facts['user_id']) }}"
      ansible.builtin.command: git config --global --get init.defaultBranch
      register: _git_verify_git_branch
      changed_when: false
      failed_when: _git_verify_git_branch.stdout != 'main'

    - name: Check git core.editor  # noqa: command-instead-of-module
      become: true
      become_user: "{{ ansible_facts['env']['SUDO_USER'] | default(ansible_facts['user_id']) }}"
      ansible.builtin.command: git config --global --get core.editor
      register: _git_verify_git_editor
      changed_when: false
      failed_when: _git_verify_git_editor.stdout != 'vim'

    - name: Check git pull.rebase  # noqa: command-instead-of-module
      become: true
      become_user: "{{ ansible_facts['env']['SUDO_USER'] | default(ansible_facts['user_id']) }}"
      ansible.builtin.command: git config --global --get pull.rebase
      register: _git_verify_git_rebase
      changed_when: false
      failed_when: _git_verify_git_rebase.stdout != 'true'

    - name: Show test results
      ansible.builtin.debug:
        msg:
          - "All checks passed!"
          - "init.defaultBranch = main"
          - "core.editor = vim"
          - "pull.rebase = true"
