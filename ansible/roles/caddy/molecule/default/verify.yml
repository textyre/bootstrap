---
- name: Verify
  hosts: all
  become: true
  gather_facts: true
  vars_files:
    - "{{ lookup('env', 'MOLECULE_PROJECT_DIRECTORY') }}/inventory/group_vars/all/vault.yml"

  tasks:
    - name: Check caddy base directory exists
      ansible.builtin.stat:
        path: /opt/caddy
      register: _caddy_verify_base_dir
      failed_when: not _caddy_verify_base_dir.stat.exists

    - name: Check Caddyfile exists
      ansible.builtin.stat:
        path: /opt/caddy/Caddyfile
      register: _caddy_verify_caddyfile
      failed_when: not _caddy_verify_caddyfile.stat.exists

    - name: Check docker-compose.yml exists
      ansible.builtin.stat:
        path: /opt/caddy/docker-compose.yml
      register: _caddy_verify_compose
      failed_when: not _caddy_verify_compose.stat.exists

    - name: Check sites directory exists
      ansible.builtin.stat:
        path: /opt/caddy/sites
      register: _caddy_verify_sites
      failed_when: not _caddy_verify_sites.stat.exists

    - name: Show test results
      ansible.builtin.debug:
        msg:
          - "All checks passed!"
          - "caddy base directory exists"
          - "Caddyfile exists"
          - "docker-compose.yml exists"
          - "sites directory exists"
