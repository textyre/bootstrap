---
# === Custom keymap file support ===

- name: Compute vconsole_value fact
  ansible.builtin.set_fact:
    vconsole_value: >-
      {{ '/usr/local/share/kbd/keymaps/' + (vconsole_console_map_src | basename)
         if vconsole_console_map_src | default('') | length > 0
         else vconsole_console }}
  tags: ['vconsole']

- name: Create custom keymap directory
  ansible.builtin.file:
    path: /usr/local/share/kbd/keymaps
    state: directory
    owner: root
    group: root
    mode: '0755'
  when: vconsole_console_map_src | default('') | length > 0
  tags: ['vconsole']

- name: Copy custom keymap file
  ansible.builtin.copy:
    src: "{{ vconsole_console_map_src }}"
    dest: "/usr/local/share/kbd/keymaps/{{ vconsole_console_map_src | basename }}"
    owner: root
    group: root
    mode: '0644'
  when: vconsole_console_map_src | default('') | length > 0
  notify: apply vconsole
  tags: ['vconsole']
