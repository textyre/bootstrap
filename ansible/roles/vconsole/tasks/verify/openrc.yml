---
# Проверка keymap (openrc — /etc/conf.d/keymaps)

- name: Slurp keymap config (openrc)
  ansible.builtin.slurp:
    src: /etc/conf.d/keymaps
  register: vconsole_slurp_openrc
  tags: ['vconsole']

- name: Assert keymap is set (openrc)
  ansible.builtin.assert:
    that:
      - "'keymap=\"' + vconsole_value + '\"' in (_vconsole_slurp_openrc.content | b64decode)"
    fail_msg: >-
      Keymap '{{ vconsole_value }}' not found in /etc/conf.d/keymaps.
      Content: {{ vconsole_slurp_openrc.content | b64decode }}
    quiet: true
  tags: ['vconsole']

- name: Slurp consolefont config (openrc)
  ansible.builtin.slurp:
    src: /etc/conf.d/consolefont
  register: vconsole_slurp_consolefont
  when: vconsole_console_font | default('') | length > 0
  tags: ['vconsole']

- name: Assert font is set (openrc)
  ansible.builtin.assert:
    that:
      - "'CONSOLEFONT=\"' + vconsole_console_font + '\"' in (_vconsole_slurp_consolefont.content | b64decode)"
    fail_msg: >-
      Font '{{ vconsole_console_font }}' not found in /etc/conf.d/consolefont.
      Content: {{ vconsole_slurp_consolefont.content | b64decode }}
    quiet: true
  when: vconsole_console_font | default('') | length > 0
  tags: ['vconsole']
