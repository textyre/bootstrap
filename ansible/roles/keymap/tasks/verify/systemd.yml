---
# Проверка keymap (systemd — localectl доступен)

- name: Verify console keymap (systemd)
  ansible.builtin.command: localectl status
  register: _keymap_check
  changed_when: false
  tags: ['keymap']

- name: Assert keymap is set (systemd)
  ansible.builtin.assert:
    that:
      - "_keymap_check.stdout | regex_search('VC Keymap:\\s+' + keymap_console + '(\\s|$)')"
    fail_msg: >-
      Keymap '{{ keymap_console }}' not found as VC Keymap in localectl status.
      Output: {{ _keymap_check.stdout }}
    quiet: true
  tags: ['keymap']
