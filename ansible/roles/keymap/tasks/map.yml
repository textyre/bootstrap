---
# === Custom keymap file support ===

- name: Compute _keymap_value fact
  ansible.builtin.set_fact:
    _keymap_value: >-
      {{ '/usr/local/share/kbd/keymaps/' + (keymap_console_map_src | basename)
         if keymap_console_map_src | default('') | length > 0
         else keymap_console }}
  tags: ['keymap']

- name: Create custom keymap directory
  ansible.builtin.file:
    path: /usr/local/share/kbd/keymaps
    state: directory
    owner: root
    group: root
    mode: '0755'
  when: keymap_console_map_src | default('') | length > 0
  tags: ['keymap']

- name: Copy custom keymap file
  ansible.builtin.copy:
    src: "{{ keymap_console_map_src }}"
    dest: "/usr/local/share/kbd/keymaps/{{ keymap_console_map_src | basename }}"
    owner: root
    group: root
    mode: '0644'
  when: keymap_console_map_src | default('') | length > 0
  notify: apply keymap
  tags: ['keymap']
