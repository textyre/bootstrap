---
name: "Molecule Integration (NTP live sync)"

on:
  schedule:
    - cron: '0 3 * * 1'   # Weekly — Monday 03:00 UTC
  workflow_dispatch:
    inputs:
      role:
        description: 'Role to test (integration scenario)'
        default: 'ntp'
        required: false

jobs:
  integration:
    name: "${{ inputs.role || 'ntp' }} — live sync (Arch VM)"
    runs-on: [self-hosted, arch]

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Run integration scenario
        run: |
          source ansible/.venv/bin/activate
          molecule test -s integration
        working-directory: "ansible/roles/${{ inputs.role || 'ntp' }}"
