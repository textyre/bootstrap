---
name: runInSandbox
description: Сгенерировать воспроизводимый план и скрипт для запуска программы в изолированном sandbox.
argument-hint: Укажите: sandbox (напр., distrobox), дистрибутив, display server (X11/Wayland), исполняемый файл и ограничения (не менять хост).
---
---

## Цель
Предоставить последовательные, воспроизводимые инструкции для безопасного запуска указанного исполняемого файла внутри контейнера/sandbox так, чтобы хост остался нетронутым.

## Быстрые уточняющие вопросы
- Предпочтительный sandbox: `distrobox` (по умолчанию).
- Какой образ/дистрибутив внутри контейнера (`${image}`)? (по умолчанию: `archlinux:latest`)
- Display server: `X11` или `Wayland` (`${displayServer}`)? (по умолчанию: `X11`)
- Нужен ли вложенный X (`${xServer}` — `Xephyr`/`Xnest`)? (по умолчанию: нет)
- Какая команда/путь к исполняемому файлу (`${executable}`)? (любой исполняемый файл)
- Нужен ли доступ к сети, GPU, USB, звуку? (нет, используется встроенные драйвер virtual box)
- Можно ли устанавливать пакеты внутри контейнера? (да)

## Принятые начальные условия (запомнить и никогда не упоминать в ответе)
- Пользователь работает из Windows.
- Используется VirtualBox.
- В гостевой системе установлен Arch Linux (хост/VM где выполняется distrobox).
- В распоряжении есть `distrobox`. (его нужно установить)
- Дисплей-сервер — `X11`. (его по умолчанию нет)

## Жёсткие ограничения
- Не менять пакеты и конфиги хоста.
- Все установки/конфигурации — только внутри контейнера.
- Не раскрывать и не упоминать приватные начальные условия.

## Пакеты, которые нельзя менять
- Список пакетов, который должен оставаться неизменным в Arch: `docs\default-packages.md`. Принимать во внимание, чтобы понимать что нужно устанавливать внутри контейнера, а что нет.

## Формат выдачи
1) Список уточняющих вопросов (если нужно).
2) Краткий план (4–6 шагов).
3) Подробные команды (bash) для каждого шага:
	- установка distrobox
	- создать/войти в контейнер (`distrobox-create` / `distrobox-enter` или эквивалент),
	- пробросить сокеты/директории (`/tmp/.X11-unix`, `DISPLAY`, `XAUTHORITY`),
	- установить пакеты внутри контейнера (с пометкой, что меняется только контейнер),
	- запустить целевую программу в нужном DISPLAY (`DISPLAY=:1 ${executable}`),
	- (опционально) запустить оконный менеджер `${wm}` с временным конфигом.
4) Готовый one-shot скрипт `launch-${executable##name}.sh` с переменными и проверками.
5) Checklist, troubleshooting, безопасность, rollback.
6) Deliverables: команды, скрипт, проверка, ограничения.

	## Целевая задача пользователя (прописать явно)
	1) Запустить `i3` изолированно внутри `distrobox` на Arch (X11), так чтобы:
		- хостовая система и её пакеты/конфиги не менялись;
		- пользователь мог переключать WM/настройки внутри контейнера по щелчку, не затрагивая хост.

	## Дополнительные указания для генерации инструкций
	- давать конкретные и короткие инструкциии. В инструкциях не должно быть сложных условий.
	- Отмечать все команды, которые меняют что-либо — с пометкой "влияет только на контейнер".
	- Явно указывать шаги отката для каждой изменяющей операции.

## Шаблон скрипта (содержимое в ответе)
- Переменные сверху: `SANDBOX`, `IMAGE`, `DISPLAY`, `EXECUTABLE`, `WM`.
- Проверки: наличие `distrobox`/`podman`/`docker`/`x11`.
- Создание/вход в контейнер с необходимыми bind-монтами.
- Установка пакетов (в контейнере).
- Очистка и rollback команды.

## Альтернативы
- Их нет. Следовать только текущему сценарию.

## Безопасность и откат
- Все изменения внутри контейнера.
- Откат: удалить контейнер (`distrobox rm` / `podman rm -f`), удалить временные файлы, восстановить `xhost`.

## Placeholders
- `${sandbox}`, `${image}`, `${displayServer}`, `${xServer}`, `${executable}`, `${wm}`, `${packagesFile}`.

## Краткий пример (шаблон выдачи)
- Уточняющие вопросы: ...
- План: 1) создать контейнер, 2) пробросить X, 3) установить пакеты, 4) запустить Xephyr (опционально), 5) запустить приложение.
- Полные команды и скрипт: (блок для копирования).
- Checklist и Deliverables: `launch-<name>.sh`, команды запуска, проверки.

Язык ответа — тот же, что использовал пользователь (русский). Стиль — лаконичный и структурированный.