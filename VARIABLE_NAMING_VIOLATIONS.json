{
  "metadata": {
    "report_title": "Ansible Variable Naming Violations - Detailed Mapping",
    "project": "Bootstrap",
    "date": "2024-02-22",
    "total_violations": 246,
    "severity": "Critical",
    "description": "Complete mapping of all variable naming violations guiding file-by-file refactoring"
  },

  "violation_categories": {

    "1_shared_reporting_variables": {
      "category_name": "Shared Reporting Framework (_rpt_*)",
      "description": "Variables passed to common role via include_role. Used by 15+ roles",
      "priority": "HIGH",
      "violation_count": 150,
      "variable_mappings": {
        "_rpt_fact": "common_rpt_fact",
        "_rpt_phase": "common_rpt_phase",
        "_rpt_status": "common_rpt_status",
        "_rpt_detail": "common_rpt_detail",
        "_rpt_title": "common_rpt_title",
        "_rpt_footer_rows": "common_rpt_footer_rows",
        "_row": "common_rpt_row",
        "_st": "common_rpt_status_mark",
        "_mk": "common_rpt_mark"
      },
      "affected_files": [
        {
          "file": "ansible/roles/common/tasks/report_phase.yml",
          "role": "common",
          "type": "source",
          "violations": [
            {
              "line": 12,
              "pattern": "_rpt_fact",
              "context": "comment example: _rpt_fact: \"_base_system_phases\"",
              "change_type": "comment_update"
            },
            {
              "line": 13,
              "pattern": "_rpt_phase",
              "context": "comment example: _rpt_phase: \"Configure locale\"",
              "change_type": "comment_update"
            },
            {
              "line": 14,
              "pattern": "_rpt_detail",
              "context": "comment example: _rpt_detail: \"en_US.UTF-8\"",
              "change_type": "comment_update"
            },
            {
              "line": 17,
              "pattern": "_rpt_fact",
              "context": "# _rpt_fact (string) - Fact name to accumulate rows into (REQUIRED)",
              "change_type": "comment_update"
            },
            {
              "line": 18,
              "pattern": "_rpt_phase",
              "context": "# _rpt_phase (string) - Phase name (max 26 chars)",
              "change_type": "comment_update"
            },
            {
              "line": 19,
              "pattern": "_rpt_status",
              "context": "# _rpt_status (string) - done / skip / fail (default: done)",
              "change_type": "comment_update"
            },
            {
              "line": 20,
              "pattern": "_rpt_detail",
              "context": "# _rpt_detail (string) - Payload info (default: '')",
              "change_type": "comment_update"
            },
            {
              "line": 34,
              "pattern": "_rpt_phase",
              "context": "name: \"Report: {{ _rpt_phase }}\"",
              "change_type": "variable_reference"
            },
            {
              "line": 36,
              "pattern": "_rpt_fact",
              "context": "\"{{ _rpt_fact }}\": \"{{ (lookup('vars', _rpt_fact",
              "change_type": "variable_reference"
            },
            {
              "line": 38,
              "pattern": "_rpt_status",
              "context": "_st: \"{{ _rpt_status | default('done') }}\"",
              "change_type": "variable_reference"
            },
            {
              "line": 40,
              "pattern": "_rpt_phase, _rpt_detail",
              "context": "{{ '%-26s' | format(_rpt_phase) }} ... {{ _rpt_detail | truncate(24, True) }}",
              "change_type": "variable_reference"
            }
          ]
        },
        {
          "file": "ansible/roles/common/tasks/report_render.yml",
          "role": "common",
          "type": "source",
          "violations": [
            {
              "line": 10,
              "pattern": "_rpt_fact",
              "context": "# _rpt_fact: \"_base_system_phases\"",
              "change_type": "comment_update"
            },
            {
              "line": 11,
              "pattern": "_rpt_title",
              "context": "# _rpt_title: \"base_system\"",
              "change_type": "comment_update"
            },
            {
              "line": 15,
              "pattern": "_rpt_fact",
              "context": "# _rpt_fact (string) - Fact name with accumulated rows (REQUIRED)",
              "change_type": "comment_update"
            },
            {
              "line": 16,
              "pattern": "_rpt_title",
              "context": "# _rpt_title (string) - Role name for the report header (REQUIRED)",
              "change_type": "comment_update"
            },
            {
              "line": 20,
              "pattern": "_rpt_title",
              "context": "name: \"{{ _rpt_title }} â€” Execution Report\"",
              "change_type": "variable_reference"
            },
            {
              "line": 22,
              "pattern": "_rpt_fact",
              "context": "msg: \"{{ _header + (lookup('vars', _rpt_fact",
              "change_type": "variable_reference"
            },
            {
              "line": 28,
              "pattern": "_rpt_footer_rows",
              "context": "_extra: \"{{ _rpt_footer_rows | default([]) }}\"",
              "change_type": "variable_reference"
            }
          ]
        },
        {
          "file": "ansible/roles/git/tasks/main.yml",
          "role": "git",
          "type": "consumer",
          "violations": [
            {
              "line": 35,
              "pattern": "_rpt_fact",
              "context": "_rpt_fact: \"_git_phases\"",
              "change_type": "variable_definition",
              "occurrences": 1
            },
            {
              "line": 36,
              "pattern": "_rpt_phase",
              "context": "_rpt_phase: \"Preflight\"",
              "change_type": "variable_definition"
            },
            {
              "line": 37,
              "pattern": "_rpt_detail",
              "context": "_rpt_detail: \"os={{ ansible_facts['os_family'] }}\"",
              "change_type": "variable_definition"
            },
            {
              "line": 54,
              "pattern": "_rpt_fact, _rpt_phase, _rpt_detail",
              "context": "3 variables in one vars block",
              "change_type": "variable_definition",
              "occurrences": 3
            },
            {
              "line": 79,
              "pattern": "_rpt_fact, _rpt_phase, _rpt_detail",
              "context": "3 variables in one vars block",
              "change_type": "variable_definition",
              "occurrences": 3
            },
            {
              "line": 100,
              "pattern": "_rpt_fact, _rpt_phase, _rpt_detail",
              "context": "3 variables in one vars block",
              "change_type": "variable_definition",
              "occurrences": 3
            },
            {
              "line": 114,
              "pattern": "_rpt_fact, _rpt_title",
              "context": "2 variables in one vars block",
              "change_type": "variable_definition",
              "occurrences": 2
            }
          ]
        },
        {
          "file": "ansible/roles/ssh/tasks/main.yml",
          "role": "ssh",
          "type": "consumer",
          "violation_lines": [30, 31, 32, 53, 54, 55, 59, 85, 86, 87, 101, 102],
          "total_violations": 12
        },
        {
          "file": "ansible/roles/hostname/tasks/main.yml",
          "role": "hostname",
          "type": "consumer",
          "violation_lines": [51, 52, 53, 73, 74, 75],
          "total_violations": 6
        },
        {
          "file": "ansible/roles/hostname/tasks/hosts.yml",
          "role": "hostname",
          "type": "consumer",
          "violation_lines": [42, 43, 44],
          "total_violations": 3
        },
        {
          "file": "ansible/roles/locale/tasks/main.yml",
          "role": "locale",
          "type": "consumer",
          "violation_lines": [19, 20, 21, 22, 57, 58, 59, 60, 74, 75, 76, 77, 97, 98, 99, 100, 112, 113],
          "total_violations": 18
        },
        {
          "file": "ansible/roles/timezone/tasks/main.yml",
          "role": "timezone",
          "type": "consumer",
          "violation_lines": [54, 55, 56, 64, 65],
          "total_violations": 5
        },
        {
          "file": "ansible/roles/shell/tasks/main.yml",
          "role": "shell",
          "type": "consumer",
          "violation_lines": [89, 90],
          "total_violations": 2
        },
        {
          "file": "ansible/roles/shell/tasks/chsh.yml",
          "role": "shell",
          "type": "consumer",
          "violation_lines": [17, 18, 19, 20],
          "total_violations": 4
        },
        {
          "file": "ansible/roles/shell/tasks/xdg.yml",
          "role": "shell",
          "type": "consumer",
          "violation_lines": [20, 21, 22],
          "total_violations": 3
        },
        {
          "file": "ansible/roles/shell/tasks/global.yml",
          "role": "shell",
          "type": "consumer",
          "violation_lines": [68, 69, 70],
          "total_violations": 3
        },
        {
          "file": "ansible/roles/shell/tasks/install.yml",
          "role": "shell",
          "type": "consumer",
          "violation_lines": [17, 18, 19, 20],
          "total_violations": 4
        },
        {
          "file": "ansible/roles/shell/tasks/verify.yml",
          "role": "shell",
          "type": "consumer",
          "violation_lines": [106, 107, 108],
          "total_violations": 3
        },
        {
          "file": "ansible/roles/user/tasks/main.yml",
          "role": "user",
          "type": "consumer",
          "violation_lines": [31, 32, 33, 56, 57, 58, 63, 80, 81, 82, 99, 100, 101, 115, 116, 117, 139, 140],
          "total_violations": 18
        },
        {
          "file": "ansible/roles/ssh_keys/tasks/main.yml",
          "role": "ssh_keys",
          "type": "consumer",
          "violation_lines": [44, 45, 46, 57, 58],
          "total_violations": 5
        },
        {
          "file": "ansible/roles/vconsole/tasks/main.yml",
          "role": "vconsole",
          "type": "consumer",
          "violation_lines": [67, 68, 69, 70, 78, 79],
          "total_violations": 6
        },
        {
          "file": "ansible/roles/vm/tasks/main.yml",
          "role": "vm",
          "type": "consumer",
          "violation_lines": [24, 25, 42, 43, 44, 71, 72, 73, 81, 82, 83, 91, 92, 93, 126, 127, 128],
          "total_violations": 17
        },
        {
          "file": "ansible/roles/vm/tasks/_install_guest_tools.yml",
          "role": "vm",
          "type": "consumer",
          "violation_lines": [28, 29, 30, 39, 40, 41, 42, 61, 62, 63, 64, 83, 84, 85, 86, 104, 105, 106],
          "total_violations": 18
        },
        {
          "file": "ansible/roles/vm/tasks/_remove_guest_tools.yml",
          "role": "vm",
          "type": "consumer",
          "violation_lines": [50, 51, 52, 68, 69, 70],
          "total_violations": 6
        },
        {
          "file": "ansible/roles/ntp/tasks/main.yml",
          "role": "ntp",
          "type": "consumer",
          "violation_lines": [148, 149, 150, 161, 162],
          "total_violations": 5
        },
        {
          "file": "ansible/roles/ntp/tasks/detect_environment.yml",
          "role": "ntp",
          "type": "consumer",
          "violation_lines": [55, 56, 57],
          "total_violations": 3
        },
        {
          "file": "ansible/roles/fail2ban/tasks/main.yml",
          "role": "fail2ban",
          "type": "consumer",
          "violation_lines": [71, 72, 73, 83, 84],
          "total_violations": 5
        },
        {
          "file": "ansible/roles/teleport/tasks/main.yml",
          "role": "teleport",
          "type": "consumer",
          "violation_lines": [71, 72, 73, 84, 85],
          "total_violations": 5
        }
      ]
    },

    "2_verify_variables_generic": {
      "category_name": "Generic _verify_* Without Role Prefix",
      "description": "Verify variables in molecule/*/verify.yml without role prefix",
      "priority": "HIGH",
      "violation_count": 40,
      "affected_roles": ["pam_hardening", "hostctl", "hostname", "locale", "fail2ban", "ntp", "shell", "vconsole"],
      "violations_by_role": {
        "pam_hardening": {
          "file": "ansible/roles/pam_hardening/molecule/default/verify.yml",
          "mappings": {
            "_verify_faillock_conf": "pam_hardening_verify_faillock_conf",
            "_verify_faillock_content": "pam_hardening_verify_faillock_content",
            "_verify_pam_profile": "pam_hardening_verify_pam_profile",
            "_verify_pam_authfail_profile": "pam_hardening_verify_pam_authfail_profile"
          },
          "violations": [
            { "line": 15, "old_name": "_verify_faillock_conf", "new_name": "pam_hardening_verify_faillock_conf" },
            { "line": 21, "old_name": "_verify_faillock_content", "new_name": "pam_hardening_verify_faillock_content" },
            { "line": 45, "old_name": "_verify_pam_profile", "new_name": "pam_hardening_verify_pam_profile" },
            { "line": 52, "old_name": "_verify_pam_authfail_profile", "new_name": "pam_hardening_verify_pam_authfail_profile" }
          ]
        },
        "hostctl": {
          "file": "ansible/roles/hostctl/molecule/default/verify.yml",
          "mappings": {
            "_verify_version": "hostctl_verify_version",
            "_verify_profile": "hostctl_verify_profile",
            "_verify_entry": "hostctl_verify_entry",
            "_verify_applied": "hostctl_verify_applied",
            "_verify_base": "hostctl_verify_base"
          },
          "violations": [
            { "line": 10, "old_name": "_verify_version", "new_name": "hostctl_verify_version" },
            { "line": 22, "old_name": "_verify_profile", "new_name": "hostctl_verify_profile" },
            { "line": 31, "old_name": "_verify_entry", "new_name": "hostctl_verify_entry" },
            { "line": 37, "old_name": "_verify_applied", "new_name": "hostctl_verify_applied" },
            { "line": 43, "old_name": "_verify_base", "new_name": "hostctl_verify_base" }
          ]
        },
        "hostname": {
          "file": "ansible/roles/hostname/molecule/default/verify.yml",
          "mappings": {
            "_verify_hostname": "hostname_verify_hostname",
            "_verify_hosts_resolve": "hostname_verify_hosts_resolve",
            "_verify_hosts": "hostname_verify_hosts"
          },
          "violations": [
            { "line": 12, "old_name": "_verify_hostname", "new_name": "hostname_verify_hostname" },
            { "line": 23, "old_name": "_verify_hosts_resolve", "new_name": "hostname_verify_hosts_resolve" },
            { "line": 29, "old_name": "_verify_hosts", "new_name": "hostname_verify_hosts" }
          ]
        },
        "locale": {
          "file": "ansible/roles/locale/molecule/default/verify.yml",
          "mappings": {
            "_verify_locales": "locale_verify_locales",
            "_verify_locale_conf": "locale_verify_locale_conf",
            "_verify_locale_cmd": "locale_verify_locale_cmd"
          },
          "violations": [
            { "line": 20, "old_name": "_verify_locales", "new_name": "locale_verify_locales" },
            { "line": 36, "old_name": "_verify_locale_conf", "new_name": "locale_verify_locale_conf" },
            { "line": 60, "old_name": "_verify_locale_cmd", "new_name": "locale_verify_locale_cmd" }
          ]
        },
        "fail2ban": {
          "file": "ansible/roles/fail2ban/molecule/default/verify.yml",
          "mappings": {
            "_verify_version": "fail2ban_verify_version",
            "_verify_jail_config": "fail2ban_verify_jail_config",
            "_verify_maxretry": "fail2ban_verify_maxretry",
            "_verify_bantime": "fail2ban_verify_bantime"
          },
          "violations": [
            { "line": 14, "old_name": "_verify_version", "new_name": "fail2ban_verify_version" },
            { "line": 23, "old_name": "_verify_jail_config", "new_name": "fail2ban_verify_jail_config" },
            { "line": 35, "old_name": "_verify_maxretry", "new_name": "fail2ban_verify_maxretry" },
            { "line": 42, "old_name": "_verify_bantime", "new_name": "fail2ban_verify_bantime" }
          ]
        },
        "ntp": {
          "file": "ansible/roles/ntp/molecule/default/verify.yml",
          "mappings": {
            "_verify_chrony": "ntp_verify_chrony",
            "_verify_ntp_tracking": "ntp_verify_ntp_tracking",
            "_verify_ntp_sources": "ntp_verify_ntp_sources",
            "_verify_ntp_synced": "ntp_verify_ntp_synced",
            "_verify_nts_sources": "ntp_verify_nts_sources",
            "_verify_chrony_conf": "ntp_verify_chrony_conf",
            "_verify_chrony_conf_content": "ntp_verify_chrony_conf_content",
            "_verify_logdir": "ntp_verify_logdir",
            "_verify_ntsdumpdir": "ntp_verify_ntsdumpdir"
          },
          "violations": [
            { "line": 26, "old_name": "_verify_chrony", "new_name": "ntp_verify_chrony" },
            { "line": 49, "old_name": "_verify_ntp_tracking", "new_name": "ntp_verify_ntp_tracking" },
            { "line": 63, "old_name": "_verify_ntp_sources", "new_name": "ntp_verify_ntp_sources" },
            { "line": 78, "old_name": "_verify_ntp_synced", "new_name": "ntp_verify_ntp_synced" },
            { "line": 95, "old_name": "_verify_nts_sources", "new_name": "ntp_verify_nts_sources" },
            { "line": 112, "old_name": "_verify_chrony_conf", "new_name": "ntp_verify_chrony_conf" },
            { "line": 124, "old_name": "_verify_chrony_conf_content", "new_name": "ntp_verify_chrony_conf_content" },
            { "line": 171, "old_name": "_verify_logdir", "new_name": "ntp_verify_logdir" },
            { "line": 184, "old_name": "_verify_ntsdumpdir", "new_name": "ntp_verify_ntsdumpdir" }
          ]
        },
        "shell": {
          "file": "ansible/roles/shell/molecule/default/verify.yml",
          "mappings": {
            "_verify_zsh": "shell_verify_zsh",
            "_verify_xdg": "shell_verify_xdg",
            "_verify_profiled": "shell_verify_profiled",
            "_verify_profiled_content": "shell_verify_profiled_content",
            "_verify_zshenv": "shell_verify_zshenv",
            "_verify_zshenv_content": "shell_verify_zshenv_content"
          },
          "violations": [
            { "line": 20, "old_name": "_verify_zsh", "new_name": "shell_verify_zsh" },
            { "line": 48, "old_name": "_verify_xdg", "new_name": "shell_verify_xdg" },
            { "line": 70, "old_name": "_verify_profiled", "new_name": "shell_verify_profiled" },
            { "line": 82, "old_name": "_verify_profiled_content", "new_name": "shell_verify_profiled_content" },
            { "line": 108, "old_name": "_verify_zshenv", "new_name": "shell_verify_zshenv" },
            { "line": 120, "old_name": "_verify_zshenv_content", "new_name": "shell_verify_zshenv_content" }
          ]
        },
        "vconsole": {
          "file": "ansible/roles/vconsole/molecule/default/verify.yml",
          "mappings": {
            "_verify_vconsole": "vconsole_verify_vconsole",
            "_verify_localectl": "vconsole_verify_localectl",
            "_verify_keymap_openrc": "vconsole_verify_keymap_openrc",
            "_verify_keymap_runit": "vconsole_verify_keymap_runit"
          },
          "violations": [
            { "line": 19, "old_name": "_verify_vconsole", "new_name": "vconsole_verify_vconsole" },
            { "line": 25, "old_name": "_verify_localectl", "new_name": "vconsole_verify_localectl" },
            { "line": 61, "old_name": "_verify_keymap_openrc", "new_name": "vconsole_verify_keymap_openrc" },
            { "line": 68, "old_name": "_verify_keymap_runit", "new_name": "vconsole_verify_keymap_runit" }
          ]
        }
      }
    },

    "3_abbreviated_verify_variables": {
      "category_name": "Abbreviated _v_* Variables",
      "description": "Severely abbreviated variable names in ntp_audit that are hard to read",
      "priority": "MEDIUM",
      "violation_count": 16,
      "affected_role": "ntp_audit",
      "files": [
        {
          "file": "ansible/roles/ntp_audit/tasks/verify.yml",
          "type": "tasks",
          "violations": [
            { "line": 7, "old_name": "_v_script", "new_name": "ntp_audit_verify_script" },
            { "line": 13, "old_name": "_v_script", "new_name": "ntp_audit_verify_script" },
            { "line": 14, "old_name": "_v_script", "new_name": "ntp_audit_verify_script" },
            { "line": 21, "old_name": "_v_logdir", "new_name": "ntp_audit_verify_logdir" },
            { "line": 27, "old_name": "_v_logdir", "new_name": "ntp_audit_verify_logdir" },
            { "line": 28, "old_name": "_v_logdir", "new_name": "ntp_audit_verify_logdir" },
            { "line": 35, "old_name": "_v_logfile", "new_name": "ntp_audit_verify_logfile" },
            { "line": 41, "old_name": "_v_logfile", "new_name": "ntp_audit_verify_logfile" },
            { "line": 42, "old_name": "_v_logfile", "new_name": "ntp_audit_verify_logfile" },
            { "line": 49, "old_name": "_v_last_line", "new_name": "ntp_audit_verify_last_line" },
            { "line": 56, "old_name": "_v_last_line", "new_name": "ntp_audit_verify_last_line" }
          ]
        },
        {
          "file": "ansible/roles/ntp_audit/molecule/default/verify.yml",
          "type": "molecule_verify",
          "violations": [
            { "line": 14, "old_name": "_v_script", "new_name": "ntp_audit_verify_script" },
            { "line": 19, "old_name": "_v_script", "new_name": "ntp_audit_verify_script" },
            { "line": 20, "old_name": "_v_script", "new_name": "ntp_audit_verify_script" },
            { "line": 26, "old_name": "_v_src", "new_name": "ntp_audit_verify_src" },
            { "line": 31, "old_name": "_v_src", "new_name": "ntp_audit_verify_src" },
            { "line": 32, "old_name": "_v_src", "new_name": "ntp_audit_verify_src" },
            { "line": 38, "old_name": "_v_logdir", "new_name": "ntp_audit_verify_logdir" },
            { "line": 43, "old_name": "_v_logdir", "new_name": "ntp_audit_verify_logdir" },
            { "line": 44, "old_name": "_v_logdir", "new_name": "ntp_audit_verify_logdir" },
            { "line": 50, "old_name": "_v_logfile", "new_name": "ntp_audit_verify_logfile" },
            { "line": 55, "old_name": "_v_logfile", "new_name": "ntp_audit_verify_logfile" },
            { "line": 56, "old_name": "_v_logfile", "new_name": "ntp_audit_verify_logfile" },
            { "line": 62, "old_name": "_v_last_line", "new_name": "ntp_audit_verify_last_line" },
            { "line": 68, "old_name": "_v_last_line", "new_name": "ntp_audit_verify_last_line" },
            { "line": 79, "old_name": "_v_logrotate", "new_name": "ntp_audit_verify_logrotate" },
            { "line": 84, "old_name": "_v_logrotate", "new_name": "ntp_audit_verify_logrotate" },
            { "line": 85, "old_name": "_v_logrotate", "new_name": "ntp_audit_verify_logrotate" },
            { "line": 104, "old_name": "_v_alloy", "new_name": "ntp_audit_verify_alloy" },
            { "line": 109, "old_name": "_v_alloy", "new_name": "ntp_audit_verify_alloy" },
            { "line": 110, "old_name": "_v_alloy", "new_name": "ntp_audit_verify_alloy" },
            { "line": 116, "old_name": "_v_loki", "new_name": "ntp_audit_verify_loki" },
            { "line": 121, "old_name": "_v_loki", "new_name": "ntp_audit_verify_loki" },
            { "line": 122, "old_name": "_v_loki", "new_name": "ntp_audit_verify_loki" }
          ]
        }
      ]
    },

    "4_common_helper_variables": {
      "category_name": "Common Role Helper Variables",
      "description": "Helper variables in common role that lack proper prefix",
      "priority": "MEDIUM",
      "violation_count": 10,
      "affected_role": "common",
      "files": [
        {
          "file": "ansible/roles/common/tasks/check_internet.yml",
          "type": "helper",
          "violations": [
            { "line": 5, "pattern": "_check_internet_host", "new_name": "common_check_internet_host", "type": "comment" },
            { "line": 6, "pattern": "_check_internet_port", "new_name": "common_check_internet_port", "type": "comment" },
            { "line": 7, "pattern": "_check_internet_timeout", "new_name": "common_check_internet_timeout", "type": "comment" },
            { "line": 12, "pattern": "_check_internet_host is defined", "new_name": "common_check_internet_host is defined", "type": "assertion" },
            { "line": 13, "pattern": "_check_internet_port is defined", "new_name": "common_check_internet_port is defined", "type": "assertion" },
            { "line": 15, "pattern": "_check_internet_host and _check_internet_port", "new_name": "common_check_internet_host and common_check_internet_port", "type": "comment" },
            { "line": 18, "pattern": "_check_internet_host, _check_internet_port", "new_name": "common_check_internet_host, common_check_internet_port", "type": "template" },
            { "line": 20, "pattern": "_check_internet_host", "new_name": "common_check_internet_host", "type": "variable_reference" },
            { "line": 21, "pattern": "_check_internet_port", "new_name": "common_check_internet_port", "type": "variable_reference" },
            { "line": 22, "pattern": "_check_internet_timeout", "new_name": "common_check_internet_timeout", "type": "variable_reference" },
            { "line": 23, "pattern": "_common_internet_check", "new_name": "common_internet_check", "type": "register" },
            { "line": 30, "pattern": "_check_internet_host, _check_internet_port", "new_name": "common_check_internet_host, common_check_internet_port", "type": "template" }
          ]
        }
      ]
    },

    "5_defaults_with_underscore_prefix": {
      "category_name": "Underscore-Prefixed Defaults",
      "description": "Variables in defaults/main.yml with underscore prefix (internal constants)",
      "priority": "LOW",
      "violation_count": 30,
      "affected_roles": [
        "ssh_keys", "git", "ssh", "gpu_drivers", "vm", "power_management", 
        "user", "fail2ban", "sysctl", "teleport", "package_manager"
      ],
      "violations": [
        {
          "role": "ssh_keys",
          "file": "ansible/roles/ssh_keys/defaults/main.yml",
          "violations": [
            { "line": 6, "old_name": "_ssh_keys_supported_os", "new_name": "ssh_keys_supported_os" },
            { "line": 28, "old_name": "_ssh_keys_users", "new_name": "ssh_keys_users" }
          ]
        },
        {
          "role": "git",
          "file": "ansible/roles/git/defaults/main.yml",
          "violations": [
            { "line": 5, "old_name": "_git_supported_os", "new_name": "git_supported_os" }
          ]
        },
        {
          "role": "ssh",
          "file": "ansible/roles/ssh/defaults/main.yml",
          "violations": [
            { "line": 8, "old_name": "_ssh_supported_os", "new_name": "ssh_supported_os" }
          ]
        },
        {
          "role": "gpu_drivers",
          "file": "ansible/roles/gpu_drivers/defaults/main.yml",
          "violations": [
            { "line": 6, "old_name": "_gpu_drivers_supported_os", "new_name": "gpu_drivers_supported_os" },
            { "line": 39, "old_name": "_gpu_drivers_nvidia_proprietary_packages", "new_name": "gpu_drivers_nvidia_proprietary_packages" },
            { "line": 44, "old_name": "_gpu_drivers_nvidia_proprietary_multilib", "new_name": "gpu_drivers_nvidia_proprietary_multilib" },
            { "line": 47, "old_name": "_gpu_drivers_nvidia_open_packages", "new_name": "gpu_drivers_nvidia_open_packages" },
            { "line": 52, "old_name": "_gpu_drivers_nvidia_vaapi_packages", "new_name": "gpu_drivers_nvidia_vaapi_packages" },
            { "line": 55, "old_name": "_gpu_drivers_nvidia_nouveau_packages", "new_name": "gpu_drivers_nvidia_nouveau_packages" },
            { "line": 59, "old_name": "_gpu_drivers_nvidia_nouveau_multilib", "new_name": "gpu_drivers_nvidia_nouveau_multilib" },
            { "line": 62, "old_name": "_gpu_drivers_amd_packages", "new_name": "gpu_drivers_amd_packages" },
            { "line": 67, "old_name": "_gpu_drivers_amd_multilib", "new_name": "gpu_drivers_amd_multilib" },
            { "line": 72, "old_name": "_gpu_drivers_intel_packages", "new_name": "gpu_drivers_intel_packages" },
            { "line": 77, "old_name": "_gpu_drivers_intel_multilib", "new_name": "gpu_drivers_intel_multilib" },
            { "line": 81, "old_name": "_gpu_drivers_vulkan_common", "new_name": "gpu_drivers_vulkan_common" },
            { "line": 84, "old_name": "_gpu_drivers_vulkan_common_multilib", "new_name": "gpu_drivers_vulkan_common_multilib" },
            { "line": 87, "old_name": "_gpu_drivers_vulkan_tools_packages", "new_name": "gpu_drivers_vulkan_tools_packages" }
          ]
        },
        {
          "role": "vm",
          "file": "ansible/roles/vm/defaults/main.yml",
          "violations": [
            { "line": 27, "old_name": "_vm_hypervisor_map", "new_name": "vm_hypervisor_map" },
            { "line": 33, "old_name": "_vm_supported_hypervisors", "new_name": "vm_supported_hypervisors" }
          ]
        },
        {
          "role": "power_management",
          "file": "ansible/roles/power_management/defaults/main.yml",
          "violations": [
            { "line": 10, "old_name": "_power_management_supported_os", "new_name": "power_management_supported_os" },
            { "line": 14, "old_name": "_power_management_laptop_chassis_types", "new_name": "power_management_laptop_chassis_types" },
            { "line": 25, "old_name": "_power_management_is_laptop", "new_name": "power_management_is_laptop" },
            { "line": 26, "old_name": "_power_management_init", "new_name": "power_management_init" },
            { "line": 27, "old_name": "_power_management_cpu_is_intel", "new_name": "power_management_cpu_is_intel" },
            { "line": 28, "old_name": "_power_management_cpu_is_amd", "new_name": "power_management_cpu_is_amd" }
          ]
        },
        {
          "role": "user",
          "file": "ansible/roles/user/defaults/main.yml",
          "violations": [
            { "line": 5, "old_name": "_user_supported_os", "new_name": "user_supported_os" }
          ]
        },
        {
          "role": "fail2ban",
          "file": "ansible/roles/fail2ban/defaults/main.yml",
          "violations": [
            { "line": 5, "old_name": "_fail2ban_supported_os", "new_name": "fail2ban_supported_os" }
          ]
        },
        {
          "role": "sysctl",
          "file": "ansible/roles/sysctl/defaults/main.yml",
          "violations": [
            { "line": 6, "old_name": "_sysctl_supported_os", "new_name": "sysctl_supported_os" }
          ]
        },
        {
          "role": "teleport",
          "file": "ansible/roles/teleport/defaults/main.yml",
          "violations": [
            { "line": 5, "old_name": "_teleport_supported_os", "new_name": "teleport_supported_os" }
          ]
        },
        {
          "role": "package_manager",
          "file": "ansible/roles/package_manager/defaults/main.yml",
          "violations": [
            { "line": 5, "old_name": "_pkgmgr_supported_distributions", "new_name": "pkgmgr_supported_distributions" }
          ]
        }
      ]
    },

    "correctly_prefixed_patterns": {
      "description": "These patterns are CORRECTLY prefixed and should NOT be changed",
      "examples": [
        "_git_verify_*",
        "_ssh_verify_*",
        "_chezmoi_verify_*",
        "_caddy_verify_*",
        "_lightdm_verify_*",
        "_vaultwarden_verify_*",
        "_docker_verify_*",
        "_gpu_verify_*",
        "_sysctl_verify_*",
        "_zen_verify_*",
        "_firewall_verify_*",
        "_locale_check*",
        "_vm_*",
        "_hostctl_*"
      ],
      "note": "Do NOT rename these - they already follow the correct naming standard"
    }
  },

  "refactoring_phases": {
    "phase_1": {
      "name": "High Priority - Shared Reporting Variables",
      "description": "Rename _rpt_* to common_rpt_* across all roles",
      "affected_files_count": 22,
      "estimated_changes": 150,
      "roles_affected": 15,
      "order": 1
    },
    "phase_2": {
      "name": "High Priority - Generic Verify Variables",
      "description": "Rename _verify_* to role_verify_* in verify files",
      "affected_files_count": 8,
      "estimated_changes": 40,
      "roles_affected": 8,
      "order": 2
    },
    "phase_3": {
      "name": "Medium Priority - Abbreviated Variables",
      "description": "Expand _v_* to ntp_audit_verify_*",
      "affected_files_count": 2,
      "estimated_changes": 16,
      "roles_affected": 1,
      "order": 3
    },
    "phase_4": {
      "name": "Medium Priority - Common Helpers",
      "description": "Rename _check_internet_* to common_check_internet_*",
      "affected_files_count": 1,
      "estimated_changes": 10,
      "roles_affected": 1,
      "order": 4
    },
    "phase_5": {
      "name": "Low Priority - Defaults",
      "description": "Rename _* to role_* in defaults/main.yml",
      "affected_files_count": 11,
      "estimated_changes": 30,
      "roles_affected": 11,
      "order": 5
    }
  },

  "summary": {
    "total_violated_files": 54,
    "total_violations": 246,
    "total_roles_affected": 25,
    "high_priority_violations": 190,
    "medium_priority_violations": 26,
    "low_priority_violations": 30,
    "estimated_refactoring_time_hours": 16,
    "critical_dependencies": [
      "All phase_1 changes must be completed before fase_2 starts",
      "Lint checks must be run after each phase",
      "All molecule tests must pass after changes"
    ]
  }
}
