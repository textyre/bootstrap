/* === Boot Animation ===
 * All entry animations for the ctOS greeter power-on sequence.
 * Elements start hidden via .boot-pre, JS triggers animation classes.
 * CSS @keyframes handle motion; boot-animation.ts handles sequencing.
 *
 * All animations use fill-mode: both (not forwards).
 * "both" applies the from-keyframe during animation-delay (backwards fill)
 * AND keeps the to-keyframe after completion (forwards fill).
 * Without "both", elements with animation-delay flash visible during the gap.
 */

/* --- Initial hidden state --- */

.boot-pre {
  opacity: 0 !important;
  pointer-events: none;
}

/* --- Phase 1: Logo loader bar ---
 * Block stays at full width (250px from _form.css).
 * clip-path sweeps left→right, revealing the block + text in place.
 * Text at right:4px stays fixed — the clip boundary moves over it.
 * Bar overshoots past text, then Phase 2 pulls back to resting width.
 */

#ctos-block {
  clip-path: inset(0 100% 0 0);
}

@keyframes logo-load {
  from { clip-path: inset(0 100% 0 0); }
  to   { clip-path: inset(0 0% 0 0); }
}

#ctos-block.boot-loading {
  animation: logo-load var(--boot-loader-duration) cubic-bezier(0.11, 0, 0.5, 0) both;
}

/* --- Phase 2: Block pulls back to reveal OS text ---
 * Block is position:absolute left:0, so left edge stays anchored.
 * Width shrinks from 250px (full) to 170px (resting).
 * OS text is behind the block (lower z-index); revealed as block recedes.
 */

@keyframes block-pullback {
  from { width: 250px; }
  to   { width: 170px; }
}

#ctos-block.boot-pullback {
  clip-path: inset(0 0% 0 0);
  width: 170px;
  overflow: hidden;
  animation: block-pullback 700ms var(--boot-ease-decel) both;
}

#ctos-block.boot-pullback #os-prefix {
  animation: fade-in 300ms ease-out both;
  animation-delay: 300ms;
}

/* --- Phase 2: OS text fades in as block recedes --- */

.os.boot-reveal {
  animation: fade-in 600ms ease-out both;
}

/* --- Phase 1: License fade-in (concurrent with loader) --- */

@keyframes license-fade {
  from { opacity: 0; }
  to   { opacity: 1; }
}

#license.boot-enter {
  animation: license-fade 600ms ease-out both;
  animation-delay: 3000ms;
}

/* --- Phase 3: Logo shifts up --- */

@keyframes logo-shift-up {
  from { transform: translateY(100%); }
  to   { transform: translateY(0); }
}

#ctos-logo.boot-shift-up {
  animation: logo-shift-up 1000ms var(--boot-ease-decel) both;
}

/* --- Phase 3: Form slides in from above --- */

.form-container.boot-pre {
  transform: translateY(100px);
}

@keyframes form-slide-in {
  from { opacity: 0; transform: translateY(100px); }
  to   { opacity: 1; transform: translateY(0); }
}

.form-container.boot-enter {
  animation: form-slide-in 1000ms var(--boot-ease-decel) both;
}

/* --- Peripheral: Security bar lamp flicker --- */

@keyframes lamp-flicker {
  0%   { opacity: 0; }
  5%   { opacity: 0.7; }
  8%   { opacity: 0; }
  15%  { opacity: 0.9; }
  18%  { opacity: 0.1; }
  22%  { opacity: 0; }
  30%  { opacity: 0.8; }
  33%  { opacity: 0; }
  40%  { opacity: 0.6; }
  42%  { opacity: 0; }
  50%  { opacity: 0.9; }
  55%  { opacity: 0.3; }
  60%  { opacity: 0.8; }
  65%  { opacity: 0; }
  72%  { opacity: 1; }
  76%  { opacity: 0.4; }
  82%  { opacity: 1; }
  88%  { opacity: 0.6; }
  94%  { opacity: 1; }
  100% { opacity: 1; }
}

#right-edge.boot-flicker {
  animation: lamp-flicker 600ms step-end both;
  animation-delay: 1000ms;
}

/* --- Peripheral: Security meta slides out from barcode --- */

#security-meta.boot-pre {
  transform: translateX(100%);
}

@keyframes meta-slide-out {
  from { opacity: 0; transform: translateX(100%); }
  to   { opacity: 1; transform: translateX(0); }
}

#security-meta.boot-slide {
  animation: meta-slide-out 600ms var(--boot-ease-decel) both;
  animation-delay: 1300ms;
}

/* --- Peripheral: Clock fade from top --- */

#clock.boot-pre {
  transform: translateY(-20px);
}

@keyframes fade-from-top {
  from { opacity: 0; transform: translateY(-20px); }
  to   { opacity: 1; transform: translateY(0); }
}

#clock.boot-enter {
  animation: fade-from-top 1000ms var(--boot-ease-decel) both;
  animation-delay: 800ms;
}

/* --- Peripheral: Date fade from top (staggered) --- */

#date-box.boot-pre {
  transform: translateY(-20px);
}

#date-box.boot-enter {
  animation: fade-from-top 1000ms var(--boot-ease-decel) both;
  animation-delay: 850ms;
}

/* --- Peripheral: Arch logo scale-in --- */

#arch-logo.boot-pre {
  transform: scale(0.5);
}

@keyframes arch-scale-in {
  from { opacity: 0; transform: scale(0.5); }
  to   { opacity: 1; transform: scale(1); }
}

#arch-logo.boot-enter {
  animation: arch-scale-in 3000ms var(--boot-ease-decel) both;
  animation-delay: 800ms;
}

/* --- Peripheral: Env block 3-phase reveal ---
 * clip-path with calc(50% - 1px) so the strip is a visible 2px line.
 * Linear timing so keyframe % = real time.
 */

#env-block.boot-pre {
  clip-path: inset(calc(50% - 1px) calc(50% - 1px) calc(50% - 1px) calc(50% - 1px));
}

@keyframes env-expand {
  0%   { clip-path: inset(calc(50% - 1px) calc(50% - 1px) calc(50% - 1px) calc(50% - 1px)); opacity: 0; }
  5%   { clip-path: inset(calc(50% - 1px) calc(50% - 1px) calc(50% - 1px) calc(50% - 1px)); opacity: 1; }
  20%  { clip-path: inset(0% calc(50% - 1px) 0% calc(50% - 1px)); opacity: 1; }
  52%  { clip-path: inset(0% calc(50% - 1px) 0% calc(50% - 1px)); opacity: 1; }
  100% { clip-path: inset(0% 0% 0% 0%); opacity: 1; }
}

#env-block.boot-expand {
  animation: env-expand 800ms linear both;
  animation-delay: 600ms;
}

/* Text fades in during horizontal expand phase */
#env-block.boot-expand .info-col {
  opacity: 0;
  animation: fade-in 300ms ease-out both;
  animation-delay: 1000ms;
}

/* --- Peripheral: Bottom-left fade-in --- */

@keyframes fade-in {
  from { opacity: 0; }
  to   { opacity: 1; }
}

#bottom-left.boot-enter {
  animation: fade-in 400ms ease-out both;
}

/* --- Reduced motion --- */

@media (prefers-reduced-motion: reduce) {
  #ctos-logo {
    transform: none;
  }

  #ctos-block {
    clip-path: none;
    width: 170px;
  }

  .boot-pre {
    opacity: 1 !important;
    clip-path: none !important;
    transform: none !important;
    pointer-events: auto !important;
  }

  #ctos-block.boot-loading,
  #ctos-block.boot-pullback {
    clip-path: none;
    width: 170px;
    animation: none;
  }

  #os-prefix {
    opacity: 1 !important;
  }

  .os.boot-reveal {
    animation: none !important;
    opacity: 1 !important;
  }

  .form-container.boot-enter,
  #ctos-logo.boot-shift-up,
  #right-edge.boot-flicker,
  #security-meta.boot-slide,
  #clock.boot-enter,
  #date-box.boot-enter,
  #arch-logo.boot-enter,
  #env-block.boot-expand,
  #env-block.boot-expand .info-col,
  #bottom-left.boot-enter,
  #license.boot-enter {
    animation: none !important;
    opacity: 1 !important;
    transform: none !important;
    clip-path: none !important;
  }
}
