{{- $t := index .themes .theme_name -}}
#!/usr/bin/env bash
# Lock screen with blurred screenshot + i3lock-color
# Themed via chezmoi

set -euo pipefail

TMPIMG="/tmp/lock-screen-$$.png"
trap 'rm -f "$TMPIMG"' EXIT

# Capture screenshot (maim is ~10x faster than import) and blur
maim "$TMPIMG"
convert "$TMPIMG" -blur {{ .lock.blur_radius }} -modulate {{ .lock.brightness }} "$TMPIMG"

# Lock with i3lock-color
i3lock \
    --image="$TMPIMG" \
    --color="{{ $t.bg }}ff" \
    --inside-color="{{ $t.bg }}cc" \
    --ring-color="{{ $t.accent }}ff" \
    --ringver-color="{{ $t.success }}ff" \
    --ringwrong-color="{{ $t.urgent }}ff" \
    --line-uses-ring \
    --keyhl-color="{{ $t.accent2 }}ff" \
    --bshl-color="{{ $t.urgent }}ff" \
    --separator-color="{{ $t.bg }}ff" \
    --verif-color="{{ $t.fg }}ff" \
    --wrong-color="{{ $t.urgent }}ff" \
    --modif-color="{{ $t.fg_dim }}ff" \
    --layout-color="{{ $t.fg_dim }}ff" \
    --time-color="{{ $t.fg }}ff" \
    --date-color="{{ $t.fg_dim }}ff" \
    --time-font="{{ .font.mono }}" \
    --date-font="{{ .font.mono }}" \
    --verif-font="{{ .font.mono }}" \
    --wrong-font="{{ .font.mono }}" \
    --clock \
    --time-str="{{ .lock.time_format }}" \
    --date-str="{{ .lock.date_format }}" \
    --indicator \
    --radius={{ .lock.indicator_radius }} \
    --ring-width={{ .lock.ring_width }} \
    --noinput-text="{{ .lock.noinput_text }}" \
    --verif-text="{{ .lock.verif_text }}" \
    --wrong-text="{{ .lock.wrong_text }}" \
    --nofork
