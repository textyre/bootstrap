{{- $t := index .themes .theme_name -}}
# Picom compositor — Cyberpunk Rice
# Generated by chezmoi — DO NOT EDIT DIRECTLY
# Upstream picom v12+ (yshui/picom)

# === BACKEND ===
backend = "glx";
# vsync = true; # don't touch
# use-damage = true; # don't touch

# === GLOBAL DEFAULTS ===
corner-radius = {{ .layout.corner_radius }};
shadow = true;
shadow-radius = {{ .picom.shadow_radius }};
shadow-offset-x = {{ .picom.shadow_offset_x }};
shadow-offset-y = {{ .picom.shadow_offset_y }};
shadow-opacity = {{ .picom.shadow_opacity }};

detect-client-opacity = true;
detect-rounded-corners = true;

# === BLUR ===
blur-background = true;
blur-background-frame = true;

blur: {
  method = "{{ .picom.blur_method }}";
  strength = {{ .picom.blur_strength }};
};

# === FADING ===
fading = false;

# === ANIMATIONS (upstream picom v12+) ===
animations = (
  {
    triggers = ["open", "show"];
    preset = "appear";
    duration = 0.2;
  },
  {
    triggers = ["close", "hide"];
    preset = "disappear";
    duration = 0.2;
  }
)

# === WINDOW RULES ===
rules: (
  {
    opacity = {{ .picom.active_opacity }};
  },
  {
    match = "!focused";
    opacity = {{ .picom.inactive_opacity }};
  },
  {
    match = "window_type = 'dock'";
    opacity = 1;
    shadow = false;
    blur-background = false;
    corner-radius = 0;
    animations = ({
      triggers = ["open", "show"];
      preset = "appear";
      duration = 0.3;
    });
  },
  {
    match = "window_type = 'desktop'";
    opacity = 1;
    shadow = false;
    blur-background = false;
    corner-radius = 0;
  },
  {
    match = "class_g = 'firefox' || class_g = 'Brave-browser'";
    opacity = {{ .picom.opacity_firefox_f }};
  },
  {
    match = "fullscreen";
    opacity = 1;
    corner-radius = 0;
  },
  {
    match = "class_g = 'Alacritty' && focused";
    opacity = {{ .picom.opacity_terminal_focused_f }};
  },
  {
    match = "class_g = 'Alacritty' && !focused";
    opacity = {{ .picom.opacity_terminal_unfocused_f }};
  },
  {
    match = "class_g = 'Rofi'";
    opacity = {{ .picom.opacity_rofi_f }};
  },
  {
    match = "class_g = 'Polybar'";
    opacity = 1;
    shadow = false;
    blur-background = false;
  },
  {
    match = "window_type = 'tooltip'";
    shadow = false;
    opacity = 0.9;
    corner-radius = 0;
    animations = ();
  },
  {
    match = "window_type = 'popup_menu' || window_type = 'dropdown_menu'";
    opacity = 0.95;
    shadow = true;
  },
  {
    match = "window_type = 'dnd'";
    opacity = 1;
    shadow = false;
  },
  {
    match = "_GTK_FRAME_EXTENTS@";
    opacity = 1;
    shadow = false;
  },
  # Thunar: после popup_menu чтобы перезаписать opacity для контекстных меню
  {
    match = "class_g = 'Thunar'";
    animations = ();
    shadow = false;
    blur-background = false;
    opacity = 1;
    fade = false;
  }
)
