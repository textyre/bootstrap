#!/usr/bin/env bash
# ============================================================
# Layout Constants Generator
# Generated by chezmoi apply — creates ~/.config/layout-constants.sh
# Source: .chezmoidata/layout.toml + themes.toml + fonts.toml
# ============================================================

set -euo pipefail

{{- $t := index .themes .theme_name }}

mkdir -p ~/.config

cat > ~/.config/layout-constants.sh << 'CONSTANTS'
#!/usr/bin/env bash
# ============================================================
# Layout Constants — Generated by chezmoi
# DO NOT EDIT MANUALLY — changes will be overwritten
# Source: .chezmoidata/layout.toml + themes.toml + fonts.toml
# ============================================================

# === LAYOUT: Window Manager ===
readonly GAPS_INNER={{ .layout.gaps_inner }}
readonly GAPS_OUTER={{ .layout.gaps_outer }}
readonly GAPS_TOP={{ .layout.gaps_top }}
readonly BORDER_SIZE={{ .layout.border_size }}
readonly CORNER_RADIUS={{ .layout.corner_radius }}

# === LAYOUT: Bar общие ===
readonly BAR_HEIGHT={{ .layout.bar_height }}
readonly BAR_OFFSET_Y={{ .layout.bar_offset_y }}
readonly BAR_BORDER={{ .layout.bar_border }}
readonly BAR_RADIUS={{ .layout.bar_radius }}
readonly BAR_PADDING={{ .layout.bar_padding }}
readonly BAR_PADDING_WS={{ .layout.bar_padding_ws }}
readonly SEP_GAP={{ .layout.sep_gap }}
readonly FONT_OFFSET={{ .layout.font_offset }}

# === LAYOUT: Bar ширины ===
readonly BAR_WIDTH_WORKSPACES={{ .layout.bar_width_workspaces }}
readonly BAR_WIDTH_CLOCK={{ .layout.bar_width_clock }}
readonly BAR_WIDTH_SYSTEM={{ .layout.bar_width_system }}

# === LAYOUT: Workspaces ===
readonly EDGE_PADDING={{ .layout.edge_padding }}
readonly ICON_WIDTH={{ .layout.icon_width }}
readonly WS_ADD_GAP={{ .layout.ws_add_gap }}
readonly MIN_WORKSPACES={{ .layout.min_workspaces }}
readonly MAX_WORKSPACES={{ .layout.max_workspaces }}

# === LAYOUT: Network ===
readonly NETWORK_INTERFACE_TYPE="{{ .layout.network_interface_type }}"

# === THEME: Colors ===
readonly THEME_NAME="{{ .theme_name }}"
readonly THEME_BG="{{ $t.bg }}"
readonly THEME_BG_ALT="{{ $t.bg_alt }}"
readonly THEME_BG_LIGHT="{{ $t.bg_light }}"
readonly THEME_FG="{{ $t.fg }}"
readonly THEME_FG_DIM="{{ $t.fg_dim }}"
readonly THEME_ACCENT="{{ $t.accent }}"
readonly THEME_ACCENT2="{{ $t.accent2 }}"
readonly THEME_SUCCESS="{{ $t.success }}"
readonly THEME_WARNING="{{ $t.warning }}"
readonly THEME_INFO="{{ $t.info }}"
readonly THEME_URGENT="{{ $t.urgent }}"
readonly THEME_BORDER_ACTIVE="{{ $t.border_active }}"
readonly THEME_BORDER_INACTIVE="{{ $t.border_inactive }}"

# === FONTS ===
readonly FONT_MONO="{{ .font.mono }}"
readonly FONT_MONO_SIZE={{ .font.mono_size }}
readonly FONT_BAR_SIZE={{ .font.bar_size }}
readonly FONT_ICON="{{ .font.icon }}"
readonly FONT_ICON_SIZE={{ .font.icon_size }}

# ============================================================
# HELPER FUNCTIONS
# ============================================================

# Calculate workspace bar width based on workspace count
# Usage: ws_width=$(calc_ws_width 5)
calc_ws_width() {
    local ws_count="${1:-$MIN_WORKSPACES}"
    [[ $ws_count -lt $MIN_WORKSPACES ]] && ws_count=$MIN_WORKSPACES
    echo $((2 * EDGE_PADDING + ws_count * ICON_WIDTH + (ws_count - 1) * SEP_GAP))
}

# Calculate add button offset based on workspace count
# Usage: add_offset=$(calc_add_offset 5)
calc_add_offset() {
    local ws_count="${1:-$MIN_WORKSPACES}"
    local ws_width
    ws_width=$(calc_ws_width "$ws_count")
    echo $((GAPS_OUTER + ws_width + WS_ADD_GAP))
}

# Get current workspace count from i3
# Usage: ws_count=$(get_ws_count)
get_ws_count() {
    local count
    count=$(i3-msg -t get_workspaces 2>/dev/null | jq 'length' 2>/dev/null || echo "$MIN_WORKSPACES")
    [[ $count -lt $MIN_WORKSPACES ]] && count=$MIN_WORKSPACES
    echo "$count"
}
CONSTANTS

chmod 644 ~/.config/layout-constants.sh
