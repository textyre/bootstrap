# Pacman: полезные команды

Короткая шпаргалка по ежедневным операциям с пакетным менеджером Arch Linux.

## Обновление системы

- `sudo pacman -Syu` — синхронизировать базы (`-Sy`) и обновить установленные пакеты (`-u`). Этот режим подтягивает свежие списки пакетов и устанавливает новые версии только для тех пакетов, что уже стоят. Запускайте регулярно.
- `sudo pacman -Syyu` — двойное `-y` принудительно перезагружает базы (игнорируя локальный кеш зеркал) перед обновлением (`-u`). Нужно лишь при явных проблемах с синхронизацией/зеркалами; злоупотребление может перегружать зеркала.

## Работа с пакетами

- `sudo pacman -S <pkg>` — установить пакет из официальных репозиториев.
- `sudo pacman -U <pkg.tar.zst>` — установить пакет из локального файла (например, скачанного вручную).
- `sudo pacman -R <pkg>` — удалить пакет, оставив зависимости.
- `sudo pacman -Rns <pkg>` — удалить пакет вместе с зависимостями и конфигами, которые больше не нужны.

## Поиск и информация

- `pacman -Ss <pattern>` — поиск пакета в репозиториях.
- `pacman -Qs <pattern>` — поиск среди уже установленных пакетов.
- `pacman -Si <pkg>` — показать информацию о пакете в репозитории.
- `pacman -Qi <pkg>` — показать информацию об установленном пакете.
- `pacman -Ql <pkg>` — вывести список файлов, которые устанавливает пакет.
- `pacman -Qo /path/to/file` — узнать, какому пакету принадлежит файл.

## Очистка и кеш

- `sudo pacman -Sc` — удалить старые версии пакетов из кеша, оставив актуальные.
- `sudo pacman -Scc` — полностью очистить кеш (подтвердите дважды; используйте осторожно).
- `paccache -r` — оставить по 3 последние версии пакетов (не входит в базовую установку, пакет `pacman-contrib`).

## Диагностика зависимостей

- `sudo pacman -Dk` — проверить целостность базы зависимостей.
- `sudo pacman -Qdt` — вывести «осиротевшие» зависимости (установленные автоматически, но больше не требуемые).
- `sudo pacman -Rns $(pacman -Qdtq)` — удалить все осиротевшие зависимости.

## Просмотр зависимостей и описаний

- `pactree <pkg>` — показать полное дерево зависимостей пакета (включая зависимости зависимостей).
- `pactree -r <pkg>` — показать, какие пакеты зависят от указанного (полезно перед удалением).
- `pactree -d 2 <pkg>` — ограничить глубину дерева двумя уровнями (зависимости и их дети).
- `pactree -l <pkg> | sort -u` — получить плоский список всех зависимостей; добавьте `| xargs -r expac '%-30n %-60d'` для списка с описаниями (нужен `pacman-contrib`).
- `pacman -Qd` — показать все пакеты, отмеченные как зависимости (installed as deps).
- `pacman -Qi <pkg>` — разделы `Depends On`, `Optional Deps`, `Required By` содержат связи и описания пакета.
- `pacman -Si <pkg>` — аналогично для пакета в репозитории (если ещё не установлен).
- `expac '%-30n %-60d' $(pacman -Qeq) | less` — вывести список вручную установленных пакетов вместе с описанием; замените `-Qeq` на `-Qq` для всех пакетов.

## Статистика и учет

- `pacman -Qe` — показать все пакеты, установленные вручную (explicit).
- `pacman -Qq | wc -l` — посчитать общее число установленных пакетов.
- `pacman -Qnq | wc -l` — посчитать пакеты только из официальных репозиториев.
- `pacman -Qmq | wc -l` — посчитать пакеты из AUR/кастомных реп (те, что помечены как «foreign»).
- `expac '%-30n %v %m' | head` — быстрый срез по пакетам (требует `expac` из `pacman-contrib`; форматируйте под себя).

## Комбинации с AUR

Pacman напрямую не работает с AUR, но результаты команд `pacman -Qs/-Qi` помогут понять, что уже стоит из официальных реп.
Для AUR используйте `paru`, `yay` или другой помощник:

- `paru -Syu` — обновить систему + AUR.
- `paru -S <pkg>` — установить пакет из AUR/реп.

## Советы

- Перед обновлением просматривайте новостную ленту Arch: https://archlinux.org/news/
- Настройте зеркала через `reflector` или `rate-mirrors`, чтобы ускорить загрузку.
- Для критичных серверов держите локальные копии ключевых пакетов (`pacman -Sw <pkg>` скачает пакет без установки).

Используйте эти команды как основу и дополняйте их, исходя из своего рабочего процесса.
